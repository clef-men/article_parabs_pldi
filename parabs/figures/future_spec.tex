\begin{figure}
\begin{mathparpagebreakable}
    \iPersistent{(\inv\ \v{pool}\ t\ \v{depth}\ \iPredTwo\ \iPredFour)}
  \and
    \iPersistent{(\obligation\ \v{pool}\ \v{depth}\ \iProp)}
  \and
    \iPersistent{(\result\ t\ \zooVal)}
  \\
    \infer[inv-finished]{
        \inv\ \v{pool}\ t\ \v{depth}\ \iPredTwo\ \iPredFour
      \\\\
        \l{pool.finished}\ \v{pool}
    }{
      \iLater[2 \cdot \v{depth} + 1]
      \Exists \zooVal.
      \result\ t\ \zooVal
    }
  \and
    \infer[obligation-finished]{
        \obligation\ \v{pool}\ \v{depth}\ \iProp
      \\\\
        \l{pool.finished}\ \v{pool}
    }{
      \iLater[2 \cdot \v{depth} + 2]
      \iPersistently \iProp
    }
  \and
    \infer[consumer-divide]{
        \inv\ \v{pool}\ t\ \v{depth}\ \iPredTwo\ \iPredFour
      \\\\
        \consumer\ t\ \iPredThree
      \\\\
        \Forall \zooVal.
        \iPredThree\ \zooVal \iWand
        \iBigSep_{\iPredThree \in \iPredThree{}s}
          \iPredThree\ \zooVal
    }{
      \iFupd
      \iBigSep_{\iPredThree \in \iPredThree{}s}
        \consumer\ t\ \iPredThree
    }
  \and
    \infer[result-agree]{
        \result\ t\ \zooVal_1
      \\\\
        \result\ t\ \zooVal_2
    }{
      \zooVal_1 = \zooVal_2
    }
  \and
    \infer[inv-result]{
        \inv\ \v{pool}\ t\ \v{depth}\ \iPredTwo\ \iPredFour
      \\\\
        \result\ t\ \zooVal
    }{
      \iFupd
      \iLater \iPersistently \iPredFour\ \zooVal
    }
  \and
    \infer[inv-result-consumer]{
        \inv\ \v{pool}\ t\ \v{depth}\ \iPredTwo\ \iPredFour
      \\\\
        \result\ t\ \zooVal
      \\\\
        \consumer\ t\ \iPredThree
    }{
      \iFupd
      \iLater[2] \iPredThree\ \zooVal
    }
  \\
    \iSpec[
      lab=async-spec
    ]{
      \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
      \begin{inboxIndent}
        \Forall \v{ctx}\ \v{scope}. \\
        \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iWand \\
        \iWp{
          \v{task}\ \v{ctx}
        }[
          \zooVal
        ]{
          \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
          \iLater \iPredTwo\ \zooVal \iSep \\
          \iLater \iPersistently \iPredFour\ \zooVal
        }
      \end{inboxIndent}
    }{
      \c{async}\ \v{ctx}\ \v{task}
    }[
      t
    ]{
      \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
      \inv\ \v{pool}\ t\ 0\ \iPredTwo\ \iPredFour \iSep \\
      \consumer\ t\ \iPredTwo
    }
  \and
    \iSpec[
      lab=wait-spec
    ]{
      \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
      \inv\ \v{pool}\ t\ \v{depth}\ \iPredTwo\ \iPredFour
    }{
      \c{wait}\ \v{ctx}\ t
    }[
      \zooVal
    ]{
      \iCredit{2} \iSep \\
      \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
      \result\ t\ \zooVal
    }
  \and
    \iSpec[
      lab=iter-spec
    ]{
      \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
      \inv\ \v{pool}\ t\ \v{depth}\ \iPredTwo\ \iPredFour \iSep \\
      \begin{inboxIndent}
        \Forall \v{ctx}\ \v{scope}\ \zooVal. \\
        \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iWand \\
        \result\ t\ \zooVal \iWand \\
        \iWpVertical{
          \v{task}\ \v{ctx}\ \zooVal
        }[
          \c{()}
        ]{
          \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
          \iLater \iPersistently \iProp
        }
      \end{inboxIndent}
    }{
      \c{iter}\ \v{ctx}\ t\ \v{task}
    }[
      \c{()}
    ]{
      \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
      \obligation\ \v{pool}\ \v{depth}\ \iProp
    }
  \and
    \iSpec[
      lab=map-spec
    ]{
      \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
      \inv\ \v{pool}\ t_1\ \v{depth}\ \iPredTwo_1\ \iPredFour_1 \iSep \\
      \begin{inboxIndent}
        \Forall \v{ctx}\ \v{scope}\ \zooVal_1. \\
        \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iWand \\
        \result\ t_1\ \zooVal_1 \iWand \\
        \iWpVertical{
          \v{task}\ \v{ctx}\ \zooVal_1
        }[
          \zooVal_2
        ]{
          \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
          \iLater \iPredTwo_2\ \zooVal_2 \iSep \\
          \iLater \iPersistently \iPredFour_2\ \zooVal_2
        }
      \end{inboxIndent}
    }{
      \c{map}\ \v{ctx}\ t_1\ \v{task}
    }[
      t_2
    ]{
      \l{pool.context}\ \v{pool}\ \v{ctx}\ \v{scope} \iSep \\
      \inv\ \v{pool}\ t_2\ (\v{depth} + 1)\ \iPredTwo_2\ \iPredFour_2 \iSep \\
      \consumer\ t_2\ \iPredTwo_2
    }
\end{mathparpagebreakable}
\caption{\ocamlinline{Future}: Specification}
\label{fig:parabs_future_spec}
\end{figure}
